<script type="text/javascript">
  RED.nodes.registerType("measurement", {
    category: "quantum",
    color: "#33B1FF",
    defaults: {
      name: { value: "" },
      selectedCbit : {value: ""},
      selectedCreg: {value: ""},
    },
    inputs: 1,
    outputs: 1,
    icon: "function.svg",
    paletteLabel: "measurement",
    label: function () {
      return this.name || "measurement";
    },
    oneditprepare: function() {
      var selectedCbit = this.selectedCbit;
      var selectedCreg = this.selectedCreg;
      
      // Get request to classical-register http admin endpoint to get
      // register variable and number of bits
      $.getJSON('classical-register', function(data) {
        let options = []
        let cregVar = data.registerVar;
        for (let i = 0; i < Number(data.bits); i++) {
          options.push(i);
        }
        // dynamically adding classical bit indices to select tag
        $("#node-input-cbitindex").empty();
        options.forEach((item) => {
          $("#node-input-cbitindex").append(
              $("<option></option>").attr("value", item).text(item)
          );
        });
        // setting selected bit index from frontend variable
        $("#node-input-cbitindex").val(selectedCbit);
        
        // dynamically adding classical register variables name
        // to select tag. Now it only sets 1 classical register
        $("#node-input-cregindex").empty();
        $("#node-input-cregindex").append(
          $("<option></option>").attr("value", cregVar).text(cregVar)
        );
        // setting selected resiter variable name from frontend variable
        $("#node-input-cregindex").val(selectedCreg);
      });
     
    },
    oneditsave: function() {
      var selectBitIndex = document.getElementById("node-input-cbitindex");
      var selectRegIndex = document.getElementById("node-input-cregindex");
      this.selectedCbit = selectBitIndex.value;
      this.selectedCreg = selectRegIndex.value;
    }
    
  });
</script>

<script type="text/html" data-template-name="measurement">
  <div class="form-row">
    <label for="node-input-name"><i class="fa fa-tag"></i> Measurement Node</label>
    <input type="text" id="node-input-name" placeholder="Name" />
  </div>
  <div class="form-row">
    <label for="node-input-cregindex"><i class="fa fa-tag"></i>Save to classical register #</label>
    <select id="node-input-cregindex" placeholder="Classical Register Index">
    </select>
  </div>
  <div class="form-row">
    <label for="node-input-cbitindex"><i class="fa fa-tag"></i>Save to classical bit #</label>
    <select id="node-input-cbitindex" placeholder="Classical Bit Index">
    </select>
  </div>
</script>

<script type="text/html" data-help-name="measurement">
  <p>
    <!-- Node documentation goes here. -->
  </p>
</script>
